(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{tmrb:function(i,t,e){"use strict";e.r(t),e.d(t,"Tab1PageModule",(function(){return P}));var o=e("TEn/"),n=e("ofXK"),s=e("3Pt+"),a=e("tyNb"),c=e("mrSG"),r=e("tk/3"),l=e("AytR"),b=e("gcOT"),h=e("fXoL"),u=e("ej43");function p(i,t){if(1&i&&(h.Lb(0,"ion-title"),h.pc(1),h.Kb()),2&i){const i=h.Vb();h.xb(1),h.rc(" Hola ",i.identity[0].NOMBRE," ")}}function d(i,t){if(1&i){const i=h.Mb();h.Lb(0,"ion-item",27),h.Tb("click",(function(){h.jc(i);const e=t.$implicit;return h.Vb(2).obraSelected(e)})),h.pc(1),h.Kb()}if(2&i){const i=t.$implicit;h.xb(1),h.sc("",i.DESCRIPCION," - ",i.OBRA,"")}}function m(i,t){if(1&i&&(h.Lb(0,"ion-list"),h.nc(1,d,2,2,"ion-item",26),h.Kb()),2&i){const i=h.Vb();h.xb(1),h.bc("ngForOf",i.items)}}function g(i,t){if(1&i){const i=h.Mb();h.Lb(0,"ion-item",27),h.Tb("click",(function(){h.jc(i);const e=t.$implicit;return h.Vb(3).maquinaSelected(e)})),h.pc(1),h.Kb()}if(2&i){const i=t.$implicit;h.xb(1),h.sc("",i.NOMBRE," - ",i.COD_MAQUINA," ")}}function f(i,t){if(1&i&&(h.Lb(0,"ion-list"),h.nc(1,g,2,2,"ion-item",26),h.Kb()),2&i){const i=h.Vb(2);h.xb(1),h.bc("ngForOf",i.itemsMachine)}}function O(i,t){if(1&i){const i=h.Mb();h.Lb(0,"ion-item",28),h.Lb(1,"ion-label",7),h.pc(2,"Maquina"),h.Kb(),h.Lb(3,"ion-input",29),h.Tb("ngModelChange",(function(t){return h.jc(i),h.Vb().machine=t}))("ionFocus",(function(){return h.jc(i),h.Vb().checkMaquinaFocus()}))("ionInput",(function(t){return h.jc(i),h.Vb().getMachines(t)})),h.Kb(),h.nc(4,f,2,1,"ion-list",1),h.Kb()}if(2&i){const i=h.Vb();h.xb(3),h.bc("ngModel",i.machine),h.xb(1),h.bc("ngIf",i.isMachineAvailable)}}function M(i,t){if(1&i&&(h.Lb(0,"ion-select-option",32),h.pc(1),h.Kb()),2&i){const i=t.$implicit;h.bc("value",i.COD_INTERNO),h.xb(1),h.qc(i.NOMBRE_PRECIO)}}function C(i,t){if(1&i){const i=h.Mb();h.Lb(0,"ion-item",4),h.Lb(1,"ion-label",7),h.pc(2,"Precios"),h.Kb(),h.Lb(3,"ion-select",30),h.Tb("ionChange",(function(t){return h.jc(i),h.Vb().onChange(t)})),h.nc(4,M,2,2,"ion-select-option",31),h.Kb(),h.Kb()}if(2&i){const i=h.Vb();h.xb(3),h.bc("ngModel",i.precio.cod),h.xb(1),h.bc("ngForOf",i.precios)}}function I(i,t){1&i&&(h.Lb(0,"ion-item",4),h.Lb(1,"ion-label"),h.pc(2,"Precio seleccionado por defecto"),h.Kb(),h.Kb())}function L(i,t){if(1&i&&(h.Lb(0,"ion-select-option",32),h.pc(1),h.Kb()),2&i){const i=t.$implicit;h.bc("value",i.CAPITULO),h.xb(1),h.qc(i.NOMBRE)}}function y(i,t){if(1&i){const i=h.Mb();h.Lb(0,"ion-item",4),h.Lb(1,"ion-label",7),h.pc(2,"Cap\xedtulo"),h.Kb(),h.Lb(3,"ion-select",33),h.Tb("ngModelChange",(function(t){return h.jc(i),h.Vb().capitulo=t})),h.nc(4,L,2,2,"ion-select-option",31),h.Kb(),h.Kb()}if(2&i){const i=h.Vb();h.xb(3),h.bc("ngModel",i.capitulo),h.xb(1),h.bc("ngForOf",i.capitulos)}}function v(i,t){if(1&i){const i=h.Mb();h.Lb(0,"ion-item-sliding"),h.Lb(1,"ion-item"),h.Lb(2,"ion-label"),h.pc(3),h.Kb(),h.Kb(),h.Lb(4,"ion-item-options"),h.Lb(5,"ion-item-option",35),h.Tb("click",(function(){h.jc(i);const e=t.$implicit;return h.Vb(2).delete(e)})),h.Jb(6,"ion-icon",36),h.Kb(),h.Kb(),h.Kb()}if(2&i){const i=t.$implicit;h.xb(3),h.sc(" ",i.DESCRIPCION,", ",i.CANTIDAD," h ")}}function A(i,t){if(1&i&&(h.Lb(0,"div"),h.nc(1,v,7,2,"ion-item-sliding",34),h.Kb()),2&i){const i=h.Vb();h.xb(1),h.bc("ngForOf",i.tareas)}}const{Storage:K}=b.a,x=[{path:"",component:(()=>{class i{constructor(i,t,e,o,n,s){this.navCtrl=i,this.loading=t,this.router=e,this.alert=o,this.authService=n,this.http=s,this.myDate=(new Date).toISOString(),this.maxDate=(new Date).toISOString(),this.observations="",this.numHours=0,this.isItemAvailable=!1,this.isMachineAvailable=!1,this.showPrecios=!1,this.showMessage=!1,this.items=[],this.itemsMachine=[],this.tipo="X",this.maquina="",this.precio={cod:"",precio:""},this.price="",this.machine="",this.load()}initializeItems(){this.items=["Obra1 - 1234","Obra2 - 4321","Obra3 - 7894"]}ngOnInit(){this.load()}getItems(i){const t=i.target.value;this.items=this.obras,t&&""!==t.trim()?(this.isItemAvailable=!0,this.items=this.items.filter(i=>(console.log(i),i.DESCRIPCION.toLowerCase().indexOf(t.toLowerCase())>-1||i.OBRA.toLowerCase().indexOf(t.toLowerCase())>-1))):this.isItemAvailable=!1}getMachines(i){const t=i.target.value;this.itemsMachine=this.maquinas,t&&""!==t.trim()?(this.isMachineAvailable=!0,this.itemsMachine=this.itemsMachine.filter(i=>(console.log(i),i.NOMBRE.toLowerCase().indexOf(t.toLowerCase())>-1||i.COD_MAQUINA.toLowerCase().indexOf(t.toLowerCase())>-1))):this.isMachineAvailable=!1}obraSelected(i){this.capitulos="",this.obra=i.DESCRIPCION,this.obra_id=i.OBRA,this.isItemAvailable=!1,this.http.get(l.a.API+"/empresa/"+i.EMPRESA).subscribe(i=>{this.empresa=i,this.empresa=JSON.parse(this.empresa),this.empresa=this.empresa[0]}),this.http.get(l.a.API+"/capitulo/"+i.OBRA).subscribe(i=>{console.log("cap",i),this.capitulos=i.capitulos,this.capitulo=i.cap,this.precio.cod=i.price,this.employee_price=i.employee_price})}maquinaSelected(i){this.machine=i.NOMBRE+" - "+i.COD_MAQUINA,this.maquina=i.COD_MAQUINA,this.isMachineAvailable=!1,this.http.get(l.a.API+"/precios/"+i.COD_MAQUINA).subscribe(i=>{console.log(i),this.precios=i,this.precio.cod=this.precios[0].COD_INTERNO,this.precio.precio=this.precios[0].PRECIO,1==this.precios.length?(this.showPrecios=!1,this.showMessage=!0):this.showPrecios=!0})}load(){return Object(c.a)(this,void 0,void 0,(function*(){let i=this.loading.create({message:"Por favor espere..."});(yield i).present();let t=yield K.get({key:"my-token"});if(t=JSON.parse(t.value),console.log(t),null!=t){this.identity=t,console.log(this.identity);try{this.http.get(l.a.API+"/"+this.identity[0].EMPRESA).subscribe(i=>Object(c.a)(this,void 0,void 0,(function*(){this.obras=i,this.obras=JSON.parse(this.obras),this.http.get(l.a.API+"/workday/"+this.identity[0].COD_PERSONAL).subscribe(i=>{this.total=0,this.tareas=i,this.tareas=JSON.parse(this.tareas);for(let t=0;t<this.tareas.length;t++)this.tareas[t].CANTIDAD=parseFloat(this.tareas[t].CANTIDAD).toFixed(2),this.total=(parseFloat(this.tareas[t].CANTIDAD)+parseFloat(this.total||0)).toFixed(1);this.http.get(l.a.API+"/maquinas").subscribe(i=>{console.log(i),this.maquinas=i,console.log(this.maquinas)})},i=>Object(c.a)(this,void 0,void 0,(function*(){this.load()})))})),i=>Object(c.a)(this,void 0,void 0,(function*(){const i=yield this.alert.create({cssClass:"my-custom-class",header:"Error",subHeader:"",message:"Error al cargar los datos.",buttons:[{text:"Ok",role:"cancel",handler:()=>{this.load()}}]});yield i.present()}))),(yield i).dismiss()}catch(e){(yield i).dismiss(),this.salir()}}else(yield i).dismiss(),this.salir()}))}save(){return Object(c.a)(this,void 0,void 0,(function*(){if(null!=this.empresa&&null!=this.obra_id&&null!=this.identity[0]&&null!=this.numHours&&null!=this.observations)if("M"!=this.tipo&&"X"!=this.tipo||""!=this.maquina){let i={empresa:this.empresa.EMPRESA,obra:this.obra_id,fecha:this.myDate.slice(0,10),codigo:this.identity[0].COD_PERSONAL,descripcion:this.observations,cantidad:this.numHours,tipo:this.tipo,codigo_maquina:this.maquina,capitulo:this.capitulo,precio_maquina:this.precio.cod,precio:this.precio.precio};console.log(i);let t=this.loading.create({message:"Por favor espere..."});(yield t).present();let e=(new r.c).set("Content-Type","application/json").set("Accept","*/*");yield this.http.post(l.a.API+"/save/",i,{headers:e}).subscribe(i=>Object(c.a)(this,void 0,void 0,(function*(){yield this.http.get(l.a.API+"/workday/"+this.identity[0].COD_PERSONAL).subscribe(i=>{this.total=0,this.tareas=i,this.tareas=JSON.parse(this.tareas);for(let t=0;t<this.tareas.length;t++)this.tareas[t].CANTIDAD=parseFloat(this.tareas[t].CANTIDAD).toFixed(2),this.total=(parseFloat(this.tareas[t].CANTIDAD)+parseFloat(this.total||0)).toFixed(1)}),this.observations="",this.maquina="",this.machine="",this.capitulo="",this.numHours=0,this.obra=null,this.showPrecios=!1,(yield t).dismiss()})),i=>Object(c.a)(this,void 0,void 0,(function*(){const i=yield this.alert.create({cssClass:"my-custom-class",header:"Error",subHeader:"",message:"Error al enviar tu trabajo.",buttons:["OK"]});(yield t).dismiss(),yield i.present()})))}else{const i=yield this.alert.create({cssClass:"my-custom-class",header:"Error",subHeader:"",message:"Por favor seleccione una maquina y un precio",buttons:["OK"]});yield i.present()}else{console.log(this.empresa,this.obra_id,this.identity[0],this.numHours);const i=yield this.alert.create({cssClass:"my-custom-class",header:"Error",subHeader:"",message:"Por favor rellene el formulario .",buttons:["OK"]});yield i.present()}}))}salir(){return Object(c.a)(this,void 0,void 0,(function*(){yield this.authService.logout(),this.router.navigateByUrl("/",{replaceUrl:!0})}))}checkFocus(){this.isItemAvailable=!0,this.items=this.obras}checkMaquinaFocus(){this.isMachineAvailable=!0,this.itemsMachine=this.maquinas}incrementQty(){this.numHours+=1}byPassValue(){this.numHours<0&&(this.numHours=0),console.log(this.numHours)}decrementQty(){this.numHours<=0?this.numHours=0:this.numHours-=1}delete(i){this.http.delete(l.a.API+"/delete/"+i.LINEA+"/"+i.OBRA+"/"+this.identity[0].COD_PERSONAL).subscribe(i=>Object(c.a)(this,void 0,void 0,(function*(){yield this.http.get(l.a.API+"/workday/"+this.identity[0].COD_PERSONAL).subscribe(i=>{this.total=0,this.tareas=i,this.tareas=JSON.parse(this.tareas);for(let t=0;t<this.tareas.length;t++)this.tareas[t].CANTIDAD=parseFloat(this.tareas[t].CANTIDAD).toFixed(2),this.total=(parseFloat(this.tareas[t].CANTIDAD)+parseFloat(this.total||0)).toFixed(1);console.log(this.tareas)})})))}checkIsEnabled(){return"P"==this.tipo&&this.numHours<=0||""==this.obra?(console.log(!0),!0):"X"==this.tipo&&this.numHours<=0||""==this.maquina?(console.log(!1),!0):void 0}onChange(i){var t=this.precios.find(t=>t.COD_INTERNO===i.target.value);this.precio.precio=t.PRECIO,this.precio.cod=t.COD_INTERNO}}return i.\u0275fac=function(t){return new(t||i)(h.Ib(o.H),h.Ib(o.F),h.Ib(a.g),h.Ib(o.a),h.Ib(u.a),h.Ib(r.a))},i.\u0275cmp=h.Cb({type:i,selectors:[["app-tab1"]],decls:59,vars:19,consts:[[3,"translucent"],[4,"ngIf"],["slot","end"],[3,"fullscreen"],["lines","full"],["position","stacked"],["type","text","debounce","600","name","obra","placeholder","Buscar obra",3,"ngModel","ngModelChange","ionInput","ionFocus"],["position","floating"],["no-padding",""],["no-padding","","justify-content-start","","align-items-start",""],["size","auto","ion-item","","no-lines","","no-padding","","text-center","","col-2",""],["color","primary",3,"click"],["name","remove-outline"],["ion-item","","no-lines","","no-padding","","text-center","","col-2",""],["name","numhours","pattern","^[1-9]{1,3}$|^[0-9]{1,3}\\.[0-9]{1,3}$","clearOnEdit","true","inputmode","numeric","min","0","type","number","required","",3,"ngModel","ngModelChange","ionInput"],["name","add-outline"],["name","type","okText","Okay","cancelText","Cancelar",3,"value","ngModel","ngModelChange"],["value","X"],["value","M"],["value","P"],["lines","none",4,"ngIf"],["lines","full",4,"ngIf"],["name","observations","placeholder","Tus observaciones...",3,"ngModel","ngModelChange"],["name","time","displayFormat","DD/MM/YYYY","pickerFormat","DD/MM/YYYY",3,"ngModel","max","ngModelChange","maxChange"],["type","button","color","danger","expand","block",3,"click"],["type","submit","color","success","expand","block",3,"disabled","click"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["lines","none"],["debounce","600","name","maquina","clearOnEdit","true","required","",3,"ngModel","ngModelChange","ionFocus","ionInput"],["interface","action-sheet","name","price",3,"ngModel","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["interface","action-sheet","name","cap",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["color","danger",3,"click"],["name","trash"]],template:function(i,t){1&i&&(h.Lb(0,"ion-header",0),h.Lb(1,"ion-toolbar"),h.nc(2,p,2,1,"ion-title",1),h.Lb(3,"h4",2),h.pc(4),h.Kb(),h.Kb(),h.Kb(),h.Lb(5,"ion-content",3),h.Lb(6,"form"),h.Lb(7,"ion-item",4),h.Lb(8,"ion-label",5),h.pc(9,"Obra"),h.Kb(),h.Lb(10,"ion-searchbar",6),h.Tb("ngModelChange",(function(i){return t.obra=i}))("ionInput",(function(i){return t.getItems(i)}))("ionFocus",(function(){return t.checkFocus()})),h.Kb(),h.nc(11,m,2,1,"ion-list",1),h.Kb(),h.Lb(12,"ion-item",4),h.Lb(13,"ion-label",7),h.pc(14,"Horas"),h.Kb(),h.Lb(15,"ion-grid",8),h.Lb(16,"ion-row",9),h.Lb(17,"ion-col",10),h.Lb(18,"ion-fab-button",11),h.Tb("click",(function(){return t.decrementQty()})),h.Jb(19,"ion-icon",12),h.Kb(),h.Kb(),h.Lb(20,"ion-col",13),h.Lb(21,"ion-input",14),h.Tb("ngModelChange",(function(i){return t.numHours=i}))("ionInput",(function(){return t.byPassValue()})),h.Kb(),h.Kb(),h.Lb(22,"ion-col",10),h.Lb(23,"ion-fab-button",11),h.Tb("click",(function(){return t.incrementQty()})),h.Jb(24,"ion-icon",15),h.Kb(),h.Kb(),h.Kb(),h.Kb(),h.Kb(),h.Lb(25,"ion-item",4),h.Lb(26,"ion-label",7),h.pc(27,"Tipo"),h.Kb(),h.Lb(28,"ion-select",16),h.Tb("ngModelChange",(function(i){return t.tipo=i})),h.Lb(29,"ion-select-option",17),h.pc(30,"Mixto"),h.Kb(),h.Lb(31,"ion-select-option",18),h.pc(32,"Maquina"),h.Kb(),h.Lb(33,"ion-select-option",19),h.pc(34,"Persona"),h.Kb(),h.Kb(),h.Kb(),h.nc(35,O,5,2,"ion-item",20),h.nc(36,C,5,2,"ion-item",21),h.nc(37,I,3,0,"ion-item",21),h.nc(38,y,5,2,"ion-item",21),h.Lb(39,"ion-item",4),h.Lb(40,"ion-label",7),h.pc(41,"Observaciones"),h.Kb(),h.Lb(42,"ion-textarea",22),h.Tb("ngModelChange",(function(i){return t.observations=i})),h.Kb(),h.Kb(),h.Lb(43,"ion-item",4),h.Lb(44,"ion-label",7),h.pc(45,"Fecha"),h.Kb(),h.Lb(46,"ion-datetime",23),h.Tb("ngModelChange",(function(i){return t.myDate=i}))("maxChange",(function(i){return t.maxDate=i})),h.Kb(),h.Kb(),h.Lb(47,"ion-row"),h.Lb(48,"ion-col"),h.Lb(49,"ion-button",24),h.Tb("click",(function(){return t.salir()})),h.pc(50,"Salir"),h.Kb(),h.Kb(),h.Lb(51,"ion-col"),h.Lb(52,"ion-button",25),h.Tb("click",(function(){return t.save()})),h.pc(53," Aceptar"),h.Kb(),h.Kb(),h.Kb(),h.Kb(),h.Lb(54,"ion-header",0),h.Lb(55,"ion-toolbar"),h.Lb(56,"ion-title"),h.pc(57,"Tus obras"),h.Kb(),h.Kb(),h.Kb(),h.nc(58,A,2,1,"div",1),h.Kb()),2&i&&(h.bc("translucent",!0),h.xb(2),h.bc("ngIf",t.identity),h.xb(2),h.rc("",t.total," h"),h.xb(1),h.bc("fullscreen",!0),h.xb(5),h.bc("ngModel",t.obra),h.xb(1),h.bc("ngIf",t.isItemAvailable),h.xb(10),h.bc("ngModel",t.numHours),h.xb(7),h.bc("value",t.tipo)("ngModel",t.tipo),h.xb(7),h.bc("ngIf","P"!=t.tipo),h.xb(1),h.bc("ngIf",t.showPrecios),h.xb(1),h.bc("ngIf",t.showMessage),h.xb(1),h.bc("ngIf",t.capitulos),h.xb(4),h.bc("ngModel",t.observations),h.xb(4),h.bc("ngModel",t.myDate)("max",t.maxDate),h.xb(6),h.bc("disabled",!t.obra||!t.numHours||t.numHours<=0||""===t.capitulo||"M"==t.tipo&&""===t.maquina&&""===t.precio.cod||"X"==t.tipo&&""===t.maquina&&""===t.precio.cod),h.xb(2),h.bc("translucent",!0),h.xb(4),h.bc("ngIf",t.tareas))},directives:[o.j,o.C,n.j,o.f,s.n,s.h,s.i,o.m,o.q,o.u,o.L,s.g,s.j,o.i,o.t,o.e,o.h,o.k,o.l,o.I,s.k,s.m,o.v,o.K,o.w,o.A,o.g,o.c,o.B,o.r,n.i,o.p,o.o,o.n],styles:["h4[_ngcontent-%COMP%]{margin-right:1rem}ion-label[_ngcontent-%COMP%]{opacity:1!important}ion-fab-button[_ngcontent-%COMP%]{width:40px;height:40px}ion-row[_ngcontent-%COMP%]{margin-top:.5rem}"]}),i})()}];let D=(()=>{class i{}return i.\u0275mod=h.Gb({type:i}),i.\u0275inj=h.Fb({factory:function(t){return new(t||i)},imports:[[a.i.forChild(x)],a.i]}),i})(),P=(()=>{class i{}return i.\u0275mod=h.Gb({type:i}),i.\u0275inj=h.Fb({factory:function(t){return new(t||i)},imports:[[o.D,n.b,s.d,D]]}),i})()}}]);